<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Level 300: Lambda Cross Account Using Bucket Policy on AWS Well-Architected Labs</title><link>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/</link><description>Recent content in Level 300: Lambda Cross Account Using Bucket Policy on AWS Well-Architected Labs</description><generator>Hugo -- gohugo.io</generator><lastBuildDate>Fri, 24 Apr 2020 11:16:08 -0400</lastBuildDate><atom:link href="https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/index.xml" rel="self" type="application/rss+xml"/><item><title>Identify (or create) S3 bucket in account 2</title><link>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/1_create_bucket/</link><pubDate>Fri, 24 Apr 2020 11:16:09 -0400</pubDate><guid>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/1_create_bucket/</guid><description>This lab is best run using two AWS accounts Identify the AWS account number for account 1 (no dashes) Identify the AWS account number for account 2 (no dashes) If you only have one AWS account, then use the same AWS account number for both account1 and account2
In account 2 sign in to the S3 Management Console as an IAM user or role in your AWS account, and open the S3 console at https://console.</description></item><item><title>Create role for Lambda in account 1</title><link>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/2_create_role/</link><pubDate>Fri, 24 Apr 2020 11:16:09 -0400</pubDate><guid>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/2_create_role/</guid><description>In account 1 sign in to the AWS Management Console as an IAM user or role in your AWS account, and open the IAM console at https://console.aws.amazon.com/iam/ Click Roles on the left, then create role
AWS service will be pre-selected, select Lambda, then click Next: Permissions
Do not select any managed policies, click Next: Tags
Click Next: Review
Enter Lambda-List-S3-Role for the Role name then click Create role
From the list of roles click the name of Lambda-List-S3-Role</description></item><item><title>Create bucket policy for the S3 bucket in account 2</title><link>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/3_create_bucket_policy/</link><pubDate>Fri, 24 Apr 2020 11:16:09 -0400</pubDate><guid>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/3_create_bucket_policy/</guid><description>In account 2 sign in to the S3 Management Console as an IAM user or role in your AWS account, and open the S3 console at https://console.aws.amazon.com/s3 Click on the name of the bucket you will use for this workshop
Go to the Permissions tab
Click Bucket Policy
Enter the following JSON policy
Replace account1 with the AWS Account number (no dashes) of account 1
Replace bucketname with the S3 bucket name from account 2</description></item><item><title>Create Lambda in account 1</title><link>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/4_create_lambda/</link><pubDate>Fri, 24 Apr 2020 11:16:09 -0400</pubDate><guid>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/4_create_lambda/</guid><description>Open the Lambda console https://console.aws.amazon.com/lambda Click Create a function
Accept the default Author from scratch
Enter function name as Lambda-List-S3
Select Python 3.7 runtime
Expand Permissions, click Use an existing role, then select the Lambda-List-S3-Role
Click Create function
Replace the example function code with the following
Replace bucketname with the S3 bucket name from account 2
import json import boto3 import os import uuid def lambda_handler(event, context): try: # Create an S3 client s3 = boto3.</description></item><item><title>Tear down</title><link>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/5_cleanup/</link><pubDate>Fri, 24 Apr 2020 11:16:09 -0400</pubDate><guid>https://wellarchitectedlabs.com/security/300_labs/300_lambda_cross_account_bucket_policy/5_cleanup/</guid><description> Remove the lambda function, then roles If you created a new S3 bucket, then you may remove it</description></item></channel></rss>